# Настройка Hugging Face для распознавания спикеров

## Обзор

Для работы функции распознавания спикеров необходимо настроить доступ к моделям pyannote.audio через Hugging Face. Это включает регистрацию аккаунта, получение токена доступа и принятие условий использования моделей.

## Шаг 1: Регистрация на Hugging Face

### 1.1 Создание аккаунта
1. Перейдите на https://huggingface.co/join
2. Заполните форму регистрации:
   - **Username** - выберите уникальное имя пользователя
   - **Email** - укажите действующий email
   - **Password** - создайте надежный пароль
3. Нажмите "Create account"
4. Подтвердите email, перейдя по ссылке в письме

### 1.2 Вход в аккаунт
1. Перейдите на https://huggingface.co/login
2. Введите email и пароль
3. Нажмите "Sign in"

## Шаг 2: Получение токена доступа

### 2.1 Переход к настройкам токенов
1. Войдите в аккаунт на https://huggingface.co
2. Нажмите на свой аватар в правом верхнем углу
3. Выберите "Settings"
4. В левом меню выберите "Access Tokens"

### 2.2 Создание нового токена
1. Нажмите кнопку "New token"
2. Заполните форму:
   - **Token name**: `speech-recognition` (или любое другое название)
   - **Role**: выберите `Read`
   - **Expiration**: можно оставить "No expiration" или установить срок
3. Нажмите "Generate token"

### 2.3 Копирование токена
⚠️ **ВАЖНО**: Токен показывается только один раз!
1. Скопируйте токен (он начинается с `hf_`)
2. Сохраните токен в безопасном месте
3. Закройте окно

## Шаг 3: Принятие условий использования моделей

Для работы с распознаванием спикеров необходимо принять условия использования следующих моделей:

### 3.1 pyannote/speaker-diarization
1. Перейдите на https://huggingface.co/pyannote/speaker-diarization
2. Нажмите кнопку "Accept" в правом верхнем углу
3. Подтвердите принятие условий

### 3.2 pyannote/segmentation
1. Перейдите на https://huggingface.co/pyannote/segmentation
2. Нажмите кнопку "Accept" в правом верхнем углу
3. Подтвердите принятие условий

### 3.3 pyannote/embedding
1. Перейдите на https://huggingface.co/pyannote/embedding
2. Нажмите кнопку "Accept" в правом верхнем углу
3. Подтвердите принятие условий

## Шаг 4: Настройка проекта

### 4.1 Создание файла .env
В корневой папке проекта создайте файл `.env`:

```env
# Токен Hugging Face (замените на ваш токен)
HF_TOKEN=hf_your_actual_token_here

# Папки для файлов
UPLOAD_FOLDER=/data/uploads
RESULT_FOLDER=/data/results

# Настройки Flask
FLASK_ENV=development
FLASK_DEBUG=1
```

### 4.2 Проверка настройки
Запустите тестовый скрипт для проверки:

```bash
# Войдите в контейнер
docker-compose exec web bash

# Запустите тест
python3 /app/test_speaker_recognition.py
```

## Возможные проблемы и решения

### Проблема: "HF_TOKEN не установлен"
**Решение:**
- Проверьте, что файл `.env` создан в корневой папке проекта
- Убедитесь, что токен указан правильно (начинается с `hf_`)
- Перезапустите контейнер: `docker-compose restart`

### Проблема: "No access to pyannote/speaker-diarization"
**Решение:**
- Убедитесь, что вы приняли условия на всех трех страницах моделей
- Проверьте, что вы вошли в правильный аккаунт
- Подождите несколько минут после принятия условий

### Проблема: "Invalid token"
**Решение:**
- Проверьте, что токен скопирован полностью
- Убедитесь, что токен не истек
- Создайте новый токен, если необходимо

### Проблема: "Token expired"
**Решение:**
- Перейдите в Settings → Access Tokens
- Создайте новый токен
- Обновите файл `.env`

## Проверка работоспособности

После настройки проверьте работу:

1. **Запустите приложение:**
```bash
docker-compose up --build
```

2. **Проверьте логи:**
```bash
docker-compose logs -f web
```

3. **Ищите сообщения:**
- `"Successfully logged in to Hugging Face"`
- `"Access confirmed for pyannote/speaker-diarization"`
- `"Speaker recognition initialized successfully"`

4. **Протестируйте распознавание:**
- Загрузите аудиофайл
- Запустите распознавание
- Проверьте, что в результате есть `[SPEAKER_X]` метки

## Безопасность

- Никогда не публикуйте токен в публичных репозиториях
- Используйте переменные окружения для хранения токенов
- Регулярно обновляйте токены
- Используйте минимальные необходимые права доступа (Read)

## Поддержка

Если у вас возникли проблемы:
1. Проверьте логи приложения
2. Убедитесь, что все шаги выполнены
3. Проверьте доступность Hugging Face
4. Создайте issue в репозитории проекта 